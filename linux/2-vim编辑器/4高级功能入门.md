---
show: step
version: 0.1
enable_checker: true
---

# 高级功能入门

## 一、实验介绍

本次实验将学习vim中的其他高级功能，带大家体验更多vim的魔力。

#### 实验知识点

+ 多文件编辑
+ 可视模式
+ 视窗操作
+ 其他高级命令

## 二、实验步骤

接下来进入具体实际操作中。

### 2.1 多文件编辑

#### 2.1.1 使用vim编辑多个文件
编辑多个文件有两种形式，一种是在进入vim前使用的参数就是多个文件。另一种就是进入vim后再编辑其他的文件。
同时创建两个新文件并编辑

```
$ vim 1.txt 2.txt
```

默认进入`1.txt`文件的编辑界面

- 命令行模式下输入 `:n` 编辑 2.txt 文件，可以加 `!` 即 `:n!` 强制切换，之前一个文件的输入没有保存，仅仅切换到另一个文件
- 命令行模式下输入 `:N` 编辑 1.txt 文件，可以加 `!` 即 `:N!` 强制切换，之前文件内的输入没有保存，仅仅是切换到另一个文件

#### 2.1.2 进入vim后打开新文件

- 命令行模式下输入`:e 3.txt` 打开新文件3.txt
- 命令行模式下输入`:e#` 回到前一个文件
- 命令行模式下输入`:ls`可以列出以前编辑过的文档
- 命令行模式下输入`:b 2.txt`（或者编号）可以直接进入文件2.txt编辑
- 命令行模式下输入`:bd 2.txt`（或者编号）可以删除以前编辑过的列表中的文件项目
- 命令行模式下输入`:e! 4.txt`，新打开文件4.txt，放弃正在编辑的文件
- 命令行模式下输入`:f` 显示正在编辑的文件名
- 命令行模式下输入`:f new.txt`，改变正在编辑的文件名字为new.txt


#### 2.1.3 恢复文件

>由于在线环境的特殊性，请在本机尝试

如果因为断电等原因造成文档没有保存，可以采用恢复方式，`vim -r`进入文档后，输入`:ewcover 1.txt`来恢复

```
$ vim -r 1.txt
```

### 2.2 可视模式

#### 2.2.1 可视模式命令简介

- 在普通模式下输入 `v`（小写），进入字符选择模式，就可以移动光标，光标走过的地方就会选取。再次按下v会后就会取消选取。
- 在普通模式下输入 `Shift+v`（小写），进入行选择模式，按下V之后就会把整行选取，您可以上下移动光标选更多的行，同样，再按一次 `Shift+v` 就可以取消选取。
- 在普通模式下输入 `Ctrl+v`（小写），这是区域选择模式，可以进行矩形区域选择，再按一次 `Ctrl+v` 取消选取。
- 在可视模式下输入 `d` 删除选取区域内容
- 在可视模式下输入`y`复制选取区域内容

#### 2.2.2 可视模式命令练习
拷贝练习文件到当前目录

```
$ cp /etc/protocols .
```

打开练习文件

```
$ vim protocols
```

- 在普通模式下`9G`跳转到第9行,输入`Shift+v`（小写V），进入可视模式进行行选择，选中5行，按下`>>`缩进，将5行整体缩进一个`shiftwidth`
- 在普通模式下输入 `Ctrl+v`（小写V），进入可视模式进行矩形区域选择，选中第一列字符然后`x`删除整列

![4-2.2.2](https://doc.shiyanlou.com/document-uid49570labid19timestamp1491032454604.png/wm)

```checker
- name: check file
  script: |
    #!/bin/bash
    ls /home/shiyanlou/protocols
  error: 没有拷贝 /etc/protocols 到 /home/shiyanlou 目录下
```

### 2.3 视窗操作

#### 2.3.1 视窗操作简介

vim 可以在一个界面里打开多个窗口进行编辑，这些编辑窗口称为 vim 的视窗。
打开方法有很多种，例如可以使用在命令行模式下输入 `:new`  打开一个新的 vim 视窗，并进入视窗编辑一个新文件（普通模式下输入 `Ctrl+w `也可以），除了 `:new` 命令，下述列举的多种方法也可以在命令模式或普通模式下打开新的视窗：

**注意：快捷键可能会与浏览器的快捷键冲突，可换为 IE 浏览器进行实验或者在浏览器设置里禁用浏览器快捷键。** 

- 命令行模式下输入`:sp 1.txt` 打开新的水平分屏视窗来编辑1.txt
- 命令行模式下输入`:vsp 2.txt` 打开新的垂直分屏视窗来编辑2.txt
- 普通模式下`Ctrl+w s` 将当前窗口分割成两个水平的窗口
- 普通模式下`Ctrl+w v` 将当前窗口分割成两个垂直的窗口
- 普通模式下`Ctrl+w q`  即 :q 结束分割出来的视窗。如果在新视窗中有输入需要使用强制符！即:q!
- 普通模式下`Ctrl+w o` 打开一个视窗并且隐藏之前的所有视窗
- 普通模式下`Ctrl+w j` 移至下面视窗
- 普通模式下`Ctrl+w k` 移至上面视窗
- 普通模式下`Ctrl+w h` 移至左边视窗
- 普通模式下`Ctrl+w l` 移至右边视窗
- 普通模式下`Ctrl+w J` 将当前视窗移至下面
- 普通模式下`Ctrl+w K` 将当前视窗移至上面
- 普通模式下`Ctrl+w H` 将当前视窗移至左边
- 普通模式下`Ctrl+w L` 将当前视窗移至右边
- 普通模式下`Ctrl+w -` 减小视窗的高度
- 普通模式下`Ctrl+w +` 增加视窗的高度

#### 2.3.2 视窗操作练习
打开练习文件

```
$ vim 1.txt
```

- 命令行模式下输入`:new` 打开一个新的vim视窗
- 命令行模式下输入`:vsp 2.txt` 打开新的横向视窗来编辑2.txt
- 命令行模式下输入`:vsp 3.txt` 打开新的横向视窗来编辑3.txt
- 如果使用非chrome浏览器可以使用`Ctrl+w`进行视窗间的跳转
- 分别在不同视窗的命令行模式下输入`:q!`退出多视窗编辑

![4-2.3.2](https://doc.shiyanlou.com/document-uid49570labid19timestamp1491032466996.png/wm)

### 2.4 文档加密

#### 2.4.1 创建加密文档

```
$ vim -x file1
```

输入您的密码
确认密码
这样在下一次打开时，vim就会要求你输入密码

### 2.5 在vim执行外部命令

在命令行模式中输入`!`可以执行外部的shell命令

- `:!ls`  用于显示当前目录的内容
- `:!rm FILENAME`用于删除名为 FILENAME 的文件
- `:w FILENAME`可将当前 VIM 中正在编辑的文件另存为 FILENAME 文件

### 2.6 帮助系统

#### 2.6.1 vim中的查看帮助

- 普通模式下按`F1`打开`vim`自己预设的帮助文档
- 命令行模式下输入`:h shiftwidth` 打开名为`shiftwidth`的帮助文件
- 命令行模式下输入`:ver` 显示版本及参数

### 2.7 功能设定

#### 2.7.1 vim的功能设定

可以在编辑文件的时候进行功能设定，如命令行模式下输入`:set nu`（显示行数），设定值退出vim后不会保存。要永久保存配置需要修改vim配置文件。
vim的配置文件`~/.vimrc`(实验楼环境中配置文件在/etc/vim/vimrc)，可以打开文件进行修改，不过务必小心不要影响vim正常使用


#### 2.7.2 获取目前的设定

- 命令行模式下输入`:set`或者`:se`显示所有修改过的配置
- 命令行模式下输入`:set all` 显示所有的设定值
- 命令行模式下输入`:set option?` 显示option的设定值
- 命令行模式下输入`:set nooption` 取消当前设定值

#### 2.7.3 set功能的说明

- 命令行模式下输入`:set autoindent(ai)` 设置自动缩进
- 命令行模式下输入`:set autowrite(aw)` 设置自动存档，默认未打开
- 命令行模式下输入`:set background=dark`或`light`，设置背景风格
- 命令行模式下输入`:set backup(bk)` 设置自动备份，默认未打开
- 命令行模式下输入`: set cindent(cin)` 设置C语言风格缩进

更多详细参数请参考vim手册

## 三、实验总结

通过这四章的简单学习，相应你应该掌握了vim的基本操作和使用，但本课程的主要目的是为了让你在学习实验楼上面其他需要用到vim的课程中不会有任何问题。如果你想单纯的学习并熟练掌握vim编辑器，通过各类教程包括本课程的学习是不能够满足的，因为要熟练掌握是跟你个人的选择有关，这需要你不断的练习并坚持长期使用vim完成各种编辑操作才能达到，同时你还需要掌握如何更改和编写vim的配置文件及安装各类vim插件来实现各种强大的功能满足你的各种苛刻的需求，最后希望你在实验楼玩得愉快。